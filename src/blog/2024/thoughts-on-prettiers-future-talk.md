---
published: 2024-06-20T00:00:00.000+09:00
lastUpdated: null
author: Masafumi Koba
tags: javascript, prettier, tskaigi
---

# TSKaigi2024トーク「Prettierの未来を考える」の感想

[Prettier](https://prettier.io/)メンテナであるsosukesuzukiさんのTSKaigi2024でのトークがYouTubeに公開されているのを知り、興味があったので見てみた。

[Prettierの未来を考える - Sosuke Suzuki / TSKaigi2024 Track1 - YouTube](https://www.youtube.com/watch?v=AaVf_nVzSFs)

参照：[TSKaigi 2024 Prettierの未来を考える スピーカーノート](https://zenn.dev/sosukesuzuki/articles/756e04848885bd)

内容は動画やスピーカーノートを見てもらえればわかると思うので、ここでは個人的な感想を記す。

## Prettier登場時をふりかえる

思い返せば、Prettierを初めて知ったときはかなり衝撃を受けたように記憶している。おそらく4、5年前のこと。
なぜかと言うと、当時はコードスタイルをチームで統一させるのにESLintを使っていたのだが、ルールが多すぎてカスタマイズが大変だったのだ。
さらに、メンバーによって好みが異なるので、意思統一を図るのもそれなりに難しかった。

大変なので、当時人気だった [`eslint-config-airbnb`](https://www.npmjs.com/package/eslint-config-airbnb) といった有名企業がOSSで公開している設定を入れたりしていたが、微妙に癖があったりするので既存のコードベースに適用するのが困難なケースもかなりあった。

また、リンターなのでエラー検出系のルールももちろんあり、コードスタイル系のルールだけをチューニングする、みたいな発想もあまりなかった。

そこでPrettierが颯爽と登場し、コードスタイル統一の問題を解消してくれた。

何となく今でも覚えているのが「Formatters vs Linters」というドキュメントをPrettierが公開していて、そこでは**リンター**という概念から**フォーマッター**という概念を抽出してくれた。
これは個人的には非常に画期的な発想で、そもそも「リンター」が何の仕事をするかが（少なくとも私の頭の中では）曖昧だったのだが、概念を区別してくれたことで、それぞれの仕事にフォーカスできるようになった。つまり、リンターはバグを見つけ、フォーマッターはコードを整形する、といったように。
今でもそれっぽいドキュメント[^1]が残っているが、たしかページのタイトルが異なっていたはず。

よく「自転車置き場の議論[^2]」と言われるが、コードスタイルの些末な議論に時間を費やさなくてもいいように、いい感じのデフォルト設定を提供してそれを強制しようというやり方で（カスタマイズ範囲は最小にとどめる）、これはかなりうまくいったように思われる。

## リンターとの棲み分け

Prettierの成功はリンターのメンテナンス負荷の軽減につながっている。例えば、ESLintは最近スタイル系ルールを非推奨にしたし[^3]、私がメンテしているStylelintも16.0.0でスタイル系ルールを削除した[^4]。

メンテナーの立場からすると、スタイル系ルールは誤検出（_false positives_）などのバグが多く、また人々の好みの多様さからオプション追加のリクエストが他のルールと比べて多い。
その一方で、そういったルールはコードのバグを見つけてくれる訳でもないので、メンテに時間を取られる割にメリットが少ない。

こういった背景から、リンターとフォーマッターは徐々に分離する流れになっていると思う。
人々の好みを満たそうとすると、複雑性が増していき、どこかで損益分岐点を突破するのだ。

余談だが、Stylelintからスタイル系ルールを削除したとき、随分文句を言われた。非推奨警告を出していたにもかかわらず。
中にはPrettierは嫌いだから、そのままStylelintでコードスタイルをチェックし続けたいという人もいた。そういう背景もあって、コミュニティによるプラグインも誕生したりした[^5]。Stylelintとしては、代替にPrettierを推奨してはいたのだが。
まあ、Prettierを既存プロジェクトに適用しようとすると、一気にコードを書き換える必要が出てくるだろうから、巨大なコードベースでは案外以降が難しいのかもと思ったり。

## Biomeとの競争

トークに戻ると、Prettierの今後の課題として[Biome](https://biomejs.dev/)というRust製ツールとの競争が挙げられていた。どうしてもパフォーマンスで劣るが、それでも速度向上の改善を続けていくそうだ。

実は、JavaScriptの大規模プロジェクトに携わった経験が無いので、Prettierでパフォーマンスに困ったことは正直ない。ファイル単位だと無視できるレベルだし、ローカルで実行する際はキャッシュが効くので遅く感じたことはない。

また、CIでキャッシュ無しで実行すると遅いかもしれないが、CIでもキャッシュを活用できたり並列実行する工夫もできるので、あまりパフォーマンス向上に実感がわかなかった。まあ、速いに越したことはないけれど。もしかして、CSSやMarkdownなどのJavaScript以外のファイルを含めると、性能が劣化するのかもしれない。

ところで、Biomeがリンターやフォーマッターのツールチェインの大統一という理想を掲げていると聞いて、たしかに達成できればすごいことなんだけれど、かなり壁は高いんじゃないかと思う。

まず、速度重視で実装言語にRustを選択しているが、JavaScriptと比べるとどうしてもコントリビューター数は減るだろうし、プラグインがJSで書けないのも痛い。つまりエコシステムが発展しにくい現状となっている。今後Rust人口が劇的に増えれば状況は変わるかもしれないが、果たしてどうだろうか。JSほど敷居の低い言語ではないので、人口問題の解決はちょっと想像しづらい。

また、Prettierのように多言語対応するためには、やはり各言語用のパーサをRustで書く必要がある。これもかなりのコントリビューションを必要とするので、相当大変な道のりになりそうだ（多言語対応のパーサージェネレーターの出番かもしれない…Lrama？）。

## Out-of-the-box再考

[前回のRubyKaigi記事](rubykaigi-2024-4-out-of-the-box.md)で「Out-of-the-box」について書いたが、このトークでも似たようなことを話しているので、スピーカーノートから引用してみよう。

> 私は最近簡単なCLIツールを作るときはDenoを使うことがありますが、全く設定なしでTypeScriptとlinterとformatterが使えるようになっているというのは、ものすごく楽だと感じます。私はlinterとかformatterに比較的詳しい方だと思いますが、それでもそう思うのだから、あまり詳しくない人からしたらなおさらでしょう。

動画では[10:10](https://www.youtube.com/watch?v=AaVf_nVzSFs&t=612s)ごろ。

前回の記事では「初学者のため」ということを強調したが、熟練者もまた大きな恩恵を受けているところがとても興味深い。

つまり、人は開発を助けてくれる周辺ツール（リンター、フォーマッター、タイプチェッカーなど）のことなど細かく学びたくないのだ。自分の考えたプログラムを実行したいだけであって、開発支援ツールの設定に時間を費やしたくないし、細かい好みを反映できる柔軟な設定など求めていない。まさに「箱からとりだして」すぐに使いたいだけなのである。

奇しくもOut-of-the-boxについて記事を書いたすぐあとに、再考する機会を得たのは幸運だった。

DenoでもOut-of-the-boxが重要視されていることからもわかるように、今後新たに出現する言語やランタイムは当然のようにこの特性を備えているはずだ。なぜなら、この体験が多くのプログラマーにとって最低限の基準となるから。比較的古い言語はこの潮流に乗り遅れないようにする必要があるだろう。

私のようにEmacsにしがみついている古い頭の人間には、厳しい時代がやってくるのかもしれない…。正直、ツールをいじるのは楽しいんだけれども…。

[^1]: [Prettier vs. Linters · Prettier](https://prettier.io/docs/en/comparison)

[^2]: _bike-shedding_ と言ったりもする。参照：[Law of triviality - Wikipedia](https://en.wikipedia.org/wiki/Law_of_triviality)

[^3]: [Deprecation of formatting rules - ESLint - Pluggable JavaScript Linter](https://eslint.org/blog/2023/10/deprecating-formatting-rules/)

[^4]: [Migrating to 16.0.0 | Stylelint](https://stylelint.io/migration-guide/to-16)

[^5]: [@stylistic/stylelint-plugin - npm](https://www.npmjs.com/package/@stylistic/stylelint-plugin)
